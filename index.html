<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Auguri Matteo! ðŸŽ“</title>
  <style>
    :root{
      --bg1:#06121a; --bg2:#0b2736; --card:#071827;
      --accent1:#ff6b9f; --accent2:#5cc1ff; --accent3:#00d1a8;
      --muted:#9fb6c3; --muted-2:#7f99a6; --glass: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.06);
    }
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{
      background:
        radial-gradient(60% 60% at 10% 10%, rgba(255,107,159,0.06) 0%, transparent 30%),
        radial-gradient(60% 60% at 90% 90%, rgba(92,193,255,0.04) 0%, transparent 30%),
        linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 100%);
      display:flex;align-items:center;justify-content:center;padding:28px;color:var(--muted);
    }

    .wrap{width:100%;max-width:760px}
    .card{
      position:relative;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;padding:22px;border:1px solid var(--border);
      box-shadow:0 10px 30px rgba(0,0,0,0.6);overflow:hidden;color:var(--muted);
      backdrop-filter: blur(6px);
    }

    header{display:flex;align-items:center;gap:14px}
    .logo{
      width:64px;height:64px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent1),var(--accent2));
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px;
      box-shadow:0 8px 28px rgba(0,0,0,0.6)
    }
    h1{font-size:1.25rem;margin:0;color:#eaf6ff}
    p.lead{margin:6px 0 0 0;color:var(--muted-2);font-size:.98rem}

    .note{
      margin-top:14px;padding:14px;border-radius:12px;
      background:linear-gradient(90deg, rgba(0,0,0,0.18), rgba(255,255,255,0.01));
      display:flex;align-items:center;gap:12px;border:1px solid rgba(255,255,255,0.02)
    }
    .song{
      display:inline-flex;gap:8px;align-items:center;color:var(--accent2);font-weight:700;
      background:var(--glass);padding:8px 10px;border-radius:10px;border:1px solid rgba(92,193,255,0.08);
      color:#dff6ff; align-items: center;
    }
    .song audio{width:300px;max-width:100%;height:32px;border-radius:6px;background:transparent}

    .controls{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .btn{
      appearance:none;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;
      color:white;background:linear-gradient(90deg,var(--accent2),#7b61ff);box-shadow:0 8px 20px rgba(123,97,255,0.12)
    }
    .btn.ghost{background:transparent;color:var(--accent2);border:1px dashed rgba(92,193,255,0.08)}

    .out{margin-top:16px;min-height:96px;padding:14px;border-radius:12px;
         background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
         border:1px solid rgba(255,255,255,0.02); color:#e6fbff}
    .message{font-size:1.02rem;color:#e6fbff;display:flex;align-items:flex-start;gap:12px}
    .badge{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent3),var(--accent1));display:flex;align-items:center;justify-content:center;color:#04121a;font-weight:800;font-size:16px;flex-shrink:0}
    .text{line-height:1.35;color:#e6fbff;white-space:pre-wrap;animation:fadeIn 0.5s ease-in}

    .stanza{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      color:#fff;line-height:1.6;white-space:pre-wrap;margin:0;padding:0; font-size:1rem;
      background:linear-gradient(135deg, rgba(255,107,159,0.1), rgba(92,193,255,0.08));
      border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:12px;
      position:relative;overflow:hidden;
    }
    .stanza:before{content:"";position:absolute;top:6px;left:8px;opacity:0.6;font-size:1.2rem}
    .stanza .line{display:block;margin-bottom:6px;padding-left:24px;position:relative}
    .stanza .line:before{content:"â™ª";position:absolute;left:4px;opacity:0.7;font-size:0.9rem;color:var(--accent1)}
    .stanza{animation:slideIn 0.6s ease-out}

    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}

    .burst{position:absolute;right:18px;top:12px;pointer-events:none;opacity:0;transform:translateY(-6px);transition:opacity .4s,transform .5s}
    .burst.show{opacity:1;transform:translateY(0)}
    .spark{display:inline-block;font-size:18px;margin-left:6px;transform-origin:center;animation:pop .9s ease forwards}
    @keyframes pop{0%{transform:translateY(6px) scale(.6) rotate(0) }50%{transform:translateY(-6px) scale(1.12) rotate(12deg)}100%{transform:translateY(0) scale(1) rotate(-6deg)}}

    /* Desktop: mostra .song dentro .note */
    .mobile-song { display: none; }

    @media (max-width:520px){
      .logo{width:54px;height:54px;font-size:20px}
      .badge{width:40px;height:40px;font-size:14px}
      /* Nasconde la .song dentro .note e mostra quella fuori */
      .note .song { display: none; }
      .mobile-song { display: flex; margin-top:10px; width:100%; padding:12px; box-sizing:border-box; }
      .mobile-song audio { width:100%; height:48px; /* piÃ¹ alto per facilitare il tocco */ }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Auguri per il laureato">
      <header>
        <div class="logo">ðŸŽ“</div>
        <div>
          <h1>Auguri per la tua Laurea, Matteo!</h1>
        </div>
      </header>

      <div class="note" aria-hidden="false">
        <div style="flex:1">
          Continua a dare il massimo come hai sempre fatto!
        </div>
        <div class="song">
          ðŸŽµ <audio id="song" controls preload="none">
            <source src="Ultimo - Buongiorno Vita (Testo e Audio).mp3" type="audio/mpeg">
            Il tuo browser non supporta l'audio. <a href="cuffie.mp3">Scarica il file</a>
          </audio>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <button id="show" class="btn" type="button">Mostra il messaggio</button>
        <button id="showAuto" class="btn ghost" type="button">Premi qui per l'indizio!</button>
      </div>

      <div class="out" id="out" aria-live="polite">
        <!-- messaggio o strofa stampati qui -->
      </div>

      <div class="burst" id="burst" aria-hidden="true">
        <span class="spark">ðŸŽ‰</span><span class="spark">âœ¨</span><span class="spark">ðŸ’¥</span>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);
      const nameParam = params.get('name') ? decodeURIComponent(params.get('name')) : '';

      // Gestione audio con seek a 120s (2 minuti)
      const audioEl = document.getElementById('song');
      if (params.get('song')) {
        audioEl.src = decodeURIComponent(params.get('song'));
      }
      audioEl.addEventListener('loadedmetadata', () => {
        audioEl.currentTime = 121; // inizia a 2:01
      });
      audioEl.addEventListener('error', () => {
        console.warn('Errore nel caricamento dell\'audio');
      });

      const baseText = (who) => (who ? `${who}, ` : '') +
        "Con il regalo che ti abbiamo fatto puoi ascoltare meglio ciÃ² che piÃ¹ ti piace! " +
        "Buona fortuna per il futuro, il meglio deve ancora venire! ðŸš€";

      const stanza = `Quando avevo 15 anni, andavo al parco con le cuffie
Adesso ce ne ho 25 e vado al parco con le cuffie
Mi piace ricominciare da dove sono partito
Per essere tale e quale al ricordo di me bambino`;

      const out = document.getElementById('out');
      const burst = document.getElementById('burst');

      function showMessage(content, isStanza = false) {
        out.innerHTML = '';
        const p = document.createElement('div');
        if (isStanza) {
          p.className = 'stanza';
          const lines = content.split('\n');
          lines.forEach(line => {
            const lineEl = document.createElement('div');
            lineEl.className = 'line';
            lineEl.textContent = line;
            p.appendChild(lineEl);
          });
        } else {
          p.className = 'message';
          const badge = document.createElement('div');
          badge.className = 'badge';
          badge.textContent = nameParam ? nameParam.trim().charAt(0).toUpperCase() : 'â˜…';
          const txt = document.createElement('div');
          txt.className = 'text';
          txt.textContent = content;
          p.appendChild(badge);
          p.appendChild(txt);
        }
        out.appendChild(p);
        burst.classList.add('show');
        setTimeout(() => burst.classList.remove('show'), 1200);
      }

      document.getElementById('show').addEventListener('click', () => showMessage(baseText(nameParam)));
      document.getElementById('showAuto').addEventListener('click', () => showMessage(stanza, true));

      if (params.get('auto') === '1') {
        showMessage(baseText(nameParam));
      }
    });
  </script>
</body>
</html>
